<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <th:block th:replace="~{shared/fragments/head :: head}"></th:block>
    <title>Quản Lý Products | Admin</title>
  </head>
  <body class="admin-body">
    <th:block th:replace="~{shared/fragments/admin-sidebar :: admin-sidebar}"></th:block>

    <main class="admin-main">
      <div class="admin-header">
        <h1>Quản Lý Products</h1>
        <div class="admin-user">
          <img th:src="@{/assets/img/avatar.jpg}" alt="" class="admin-user__avatar" />
          <span th:text="${session.user.fullName}">Admin</span>
        </div>
      </div>

      <div class="admin-content">
        <div class="table-card">
          <div class="table-card__header">
            <input type="text" id="searchInput" placeholder="Tìm sản phẩm..." class="search-input" />
            <button onclick="alert('Thêm sản phẩm - Đang phát triển')" class="btn btn--primary">+ Thêm Sản Phẩm</button>
          </div>

          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Hình Ảnh</th>
                  <th>Tên Sản Phẩm</th>
                  <th>Danh Mục</th>
                  <th>Giá</th>
                  <th>Tồn Kho</th>
                  <th>Trạng Thái</th>
                  <th>Hành Động</th>
                </tr>
              </thead>
              <tbody id="productsTable">
                <tr><td colspan="8" class="text-center">Đang tải...</td></tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </main>

    <script>
      let currentPage = 0;

      document.addEventListener('DOMContentLoaded', loadProducts);

      function loadProducts() {
        fetch(`/api/products?page=${currentPage}&size=20`)
          .then(r => r.json())
          .then(data => {
            const tbody = document.getElementById('productsTable');
            if (data.products && data.products.length > 0) {
              tbody.innerHTML = data.products.map(product => `
                <tr>
                  <td>${product.id}</td>
                  <td><img src="/assets/img/product/${product.image || 'default.jpg'}" alt="" style="width:50px;height:50px;object-fit:cover;border-radius:8px" /></td>
                  <td><strong>${product.name}</strong></td>
                  <td>${product.categoryName || 'N/A'}</td>
                  <td>${new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(product.price)}</td>
                  <td>${product.stockQuantity}</td>
                  <td><span class="badge badge--${product.stockQuantity > 0 ? 'success' : 'danger'}">${product.stockQuantity > 0 ? 'Còn hàng' : 'Hết hàng'}</span></td>
                  <td>
                    <button onclick="editProduct(${product.id})" class="btn btn--small">Sửa</button>
                    <button onclick="deleteProduct(${product.id})" class="btn btn--small btn--danger">Xóa</button>
                  </td>
                </tr>
              `).join('');
            } else {
              tbody.innerHTML = '<tr><td colspan="8" class="text-center">Không có sản phẩm</td></tr>';
            }
          })
          .catch(e => {
            console.error(e);
            document.getElementById('productsTable').innerHTML = 
              '<tr><td colspan="8" class="text-center">Lỗi tải dữ liệu</td></tr>';
          });
      }

      function editProduct(id) {
        alert('Sửa sản phẩm ' + id + ' - Đang phát triển');
      }

      function deleteProduct(id) {
        if (confirm('Bạn có chắc muốn xóa sản phẩm này?')) {
          alert('Xóa sản phẩm ' + id + ' - Đang phát triển');
        }
      }
    </script>

    <style>
      .admin-body{margin:0;padding:0;background:#f5f7fa;font-family:system-ui,-apple-system,sans-serif}
      .admin-main{margin-left:260px;min-height:100vh;padding:0}
      .admin-header{background:#fff;padding:20px 32px;border-bottom:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center}
      .admin-header h1{margin:0;font-size:24px}
      .admin-user{display:flex;align-items:center;gap:12px}
      .admin-user__avatar{width:40px;height:40px;border-radius:50%}
      .admin-content{padding:32px}
      .table-card{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
      .table-card__header{display:flex;gap:16px;margin-bottom:20px}
      .search-input{padding:10px 16px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;flex:1}
      .btn--primary{padding:10px 20px;background:#77dae6;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:14px}
      .table-responsive{overflow-x:auto}
      .admin-table{width:100%;border-collapse:collapse}
      .admin-table th{text-align:left;padding:12px;border-bottom:2px solid #e0e0e0;font-weight:600;color:#666;font-size:14px}
      .admin-table td{padding:12px;border-bottom:1px solid #f0f0f0;font-size:14px}
      .badge{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500}
      .badge--success{background:#d4edda;color:#155724}
      .badge--danger{background:#f8d7da;color:#721c24}
      .btn--small{padding:6px 12px;font-size:13px;background:#77dae6;color:#fff;border:none;border-radius:6px;cursor:pointer;margin-right:4px}
      .btn--danger{background:#dc3545}
      .text-center{text-align:center}
      @media (max-width:768px){.admin-main{margin-left:0}.table-card__header{flex-direction:column}}
    </style>
  </body>
</html>
