<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('CC-Doctor - Caffeine Calculator')}"></head>

<body>
<!-- Header -->
<header th:replace="~{fragments/header :: header}"></header>

<!-- Main -->
<main class="checkout">
    <div class="container">
        <!-- Breadcrumbs -->
        <ul class="breadcrumbs checkout__breadcrumbs">
            <li>
                <a th:href="@{/}" class="breadcrumbs__link">Trang ch·ªß
                    <img th:src="@{/assets/icon/arrow-right.svg}" alt="" />
                </a>
            </li>
            <li>
                <a href="#!" class="breadcrumbs__link breadcrumbs__link--current">CC-Doctor</a>
            </li>
        </ul>

        <!-- Page Heading -->
        <div class="checkout__heading-wrap">
            <h1 class="checkout__heading">
                <img th:src="@{/assets/icon/gift.svg}" alt="" class="icon" style="width: 40px; height: 40px; margin-right: 12px;" />
                CC-Doctor - Caffeine Calculator
            </h1>
            <p class="checkout__desc">T√≠nh to√°n l∆∞·ª£ng caffeine an to√†n cho c∆° th·ªÉ b·∫°n</p>
        </div>

        <!-- Main Content -->
        <div class="row gy-xl-3">
            <!-- Left Column - Form -->
            <div class="col-8 col-xl-12">
                <div class="cart-info">
                    <div class="cart-info__top">
                        <h2 class="cart-info__heading">Th√¥ng tin c·ªßa b·∫°n</h2>
                        <p class="cart-info__desc">Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ t√≠nh to√°n ch√≠nh x√°c</p>
                    </div>

                    <!-- Error Message -->
                    <div th:if="${error}" class="alert" style="color: #dc3545; background: #f8d7da; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                        <img th:src="@{/assets/icon/error.svg}" alt="" style="width: 20px; height: 20px; margin-right: 8px;" />
                        <span th:text="${error}"></span>
                    </div>

                    <!-- Form -->
                    <form th:action="@{/cc-doctor/calculate}" method="post" th:object="${request}" class="form">
                        <div class="cart-info__row">
                            <!-- Age -->
                            <div class="form__group">
                                <label for="age" class="form__label form__label--small">Tu·ªïi <span style="color: #dc3545;">*</span></label>
                                <div class="form__text-input">
                                    <input type="number" 
                                           th:field="*{age}" 
                                           id="age" 
                                           class="form__input" 
                                           placeholder="Nh·∫≠p tu·ªïi c·ªßa b·∫°n" 
                                           required 
                                           min="1" 
                                           max="120" />
                                </div>
                            </div>

                            <!-- Gender -->
                            <div class="form__group">
                                <label class="form__label form__label--small">Gi·ªõi t√≠nh <span style="color: #dc3545;">*</span></label>
                                <div style="display: flex; gap: 24px; margin-top: 12px;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" th:field="*{gender}" value="MALE" required style="margin-right: 8px;" />
                                        <span>Nam</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" th:field="*{gender}" value="FEMALE" required style="margin-right: 8px;" />
                                        <span>N·ªØ</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="cart-info__row">
                            <!-- Pregnant -->
                            <div class="form__group">
                                <label style="display: flex; align-items: center; cursor: pointer; margin-top: 12px;">
                                    <input type="checkbox" th:field="*{isPregnant}" style="margin-right: 8px; width: 18px; height: 18px;" />
                                    <span class="form__label form__label--small" style="margin: 0;">ƒêang mang thai</span>
                                </label>
                                <p style="font-size: 14px; color: #9e9da8; margin-top: 8px;">Ch·ªâ √°p d·ª•ng cho n·ªØ gi·ªõi</p>
                            </div>
                        </div>

                        <div class="cart-info__row">
                            <!-- Drink Type -->
                            <div class="form__group">
                                <label for="drinkType" class="form__label form__label--small">Lo·∫°i ƒë·ªì u·ªëng <span style="color: #dc3545;">*</span></label>
                                <div class="form__text-input">
                                    <select th:field="*{drinkType}" id="drinkType" class="form__input" required>
                                        <option value="">-- Ch·ªçn lo·∫°i ƒë·ªì u·ªëng --</option>
                                        <optgroup label="‚òï C√† ph√™">
                                            <option th:each="drink : ${drinkTypes}" 
                                                    th:if="${drink.key.contains('C√† ph√™') or drink.key.contains('Espresso') or drink.key.contains('Americano') or drink.key.contains('Cappuccino') or drink.key.contains('Latte')}"
                                                    th:value="${drink.key}" 
                                                    th:text="${drink.key + ' - ' + drink.value + 'mg'}"></option>
                                        </optgroup>
                                        <optgroup label="üçµ Tr√†">
                                            <option th:each="drink : ${drinkTypes}" 
                                                    th:if="${drink.key.contains('Tr√†')}"
                                                    th:value="${drink.key}" 
                                                    th:text="${drink.key + ' - ' + drink.value + 'mg'}"></option>
                                        </optgroup>
                                        <optgroup label="‚ö° N∆∞·ªõc tƒÉng l·ª±c">
                                            <option th:each="drink : ${drinkTypes}" 
                                                    th:if="${drink.key.contains('Red Bull') or drink.key.contains('Monster') or drink.key.contains('Sting') or drink.key.contains('Number')}"
                                                    th:value="${drink.key}" 
                                                    th:text="${drink.key + ' - ' + drink.value + 'mg'}"></option>
                                        </optgroup>
                                        <optgroup label="ü•§ N∆∞·ªõc ng·ªçt & Kh√°c">
                                            <option th:each="drink : ${drinkTypes}" 
                                                    th:if="${drink.key.contains('Coca') or drink.key.contains('Pepsi') or drink.key.contains('S√¥-c√¥-la')}"
                                                    th:value="${drink.key}" 
                                                    th:text="${drink.key + ' - ' + drink.value + 'mg'}"></option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>

                            <!-- Quantity -->
                            <div class="form__group">
                                <label for="quantity" class="form__label form__label--small">S·ªë l∆∞·ª£ng <span style="color: #dc3545;">*</span></label>
                                <div class="form__text-input">
                                    <input type="number" 
                                           th:field="*{quantity}" 
                                           id="quantity" 
                                           class="form__input" 
                                           placeholder="S·ªë l∆∞·ª£ng" 
                                           required 
                                           min="1" 
                                           max="20" 
                                           value="1" />
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="cart-info__row">
                            <button type="submit" class="btn btn--primary btn--rounded" style="min-width: 200px;">
                                T√≠nh to√°n
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right Column - Result -->
            <div class="col-4 col-xl-12">
                <div class="cart-info" th:if="${result}">
                    <h2 class="cart-info__heading">K·∫øt qu·∫£</h2>

                    <!-- Status Badge -->
                    <div style="text-align: center; padding: 24px 0;">
                        <div th:style="'display: inline-block; padding: 12px 24px; border-radius: 99rem; font-size: 18px; font-weight: 600; background: ' + 
                                       ${result.statusColor == 'green' ? '#d4edda' : (result.statusColor == 'yellow' ? '#fff3cd' : '#f8d7da')} + '; color: ' + 
                                       ${result.statusColor == 'green' ? '#155724' : (result.statusColor == 'yellow' ? '#856404' : '#721c24')}">
                            <span th:text="${result.status == 'SAFE' ? '‚úì An to√†n' : (result.status == 'WARNING' ? '‚ö† C·∫£nh b√°o' : '‚úó Nguy hi·ªÉm')}"></span>
                        </div>
                    </div>

                    <!-- Caffeine Amount -->
                    <div class="cart-info__row" style="border-bottom: 1px solid #d2d1d6; padding-bottom: 16px; margin-bottom: 16px;">
                        <div style="text-align: center;">
                            <p style="font-size: 14px; color: #9e9da8; margin-bottom: 8px;">L∆∞·ª£ng caffeine ƒë√£ n·∫°p</p>
                            <p style="font-size: 32px; font-weight: 700; color: #1a162e; margin: 0;">
                                <span th:text="${result.totalCaffeine}"></span>mg
                            </p>
                            <p style="font-size: 14px; color: #9e9da8; margin-top: 4px;">
                                / <span th:text="${result.safeLimit}"></span>mg an to√†n
                            </p>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div style="margin: 24px 0;">
                        <div style="width: 100%; height: 24px; background: #f8f8fb; border-radius: 12px; overflow: hidden;">
                            <div th:style="'width: ' + ${result.percentage > 100 ? 100 : result.percentage} + '%; height: 100%; background: ' + 
                                           ${result.statusColor == 'green' ? '#28a745' : (result.statusColor == 'yellow' ? '#ffc107' : '#dc3545')} + 
                                           '; transition: width 0.5s ease;'"></div>
                        </div>
                        <p style="text-align: center; margin-top: 8px; font-size: 14px; font-weight: 600;">
                            <span th:text="${#numbers.formatDecimal(result.percentage, 1, 1)}"></span>%
                        </p>
                    </div>

                    <!-- Message -->
                    <div class="cart-info__row" style="background: #f8f8fb; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #1a162e;" th:text="${result.message}"></p>
                        <p style="font-size: 14px; color: #67666e; line-height: 1.6; margin: 0;" th:text="${result.recommendation}"></p>
                    </div>

                    <!-- Safe Limits Info -->
                    <div class="cart-info__separate"></div>
                    <div style="padding: 16px 0;">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">üìä Gi·ªõi h·∫°n an to√†n</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Ng∆∞·ªùi l·ªõn (18+):</span>
                                <span style="float: right; font-weight: 600;">400mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Ph·ª• n·ªØ mang thai:</span>
                                <span style="float: right; font-weight: 600;">200mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Thanh thi·∫øu ni√™n (12-18):</span>
                                <span style="float: right; font-weight: 600;">100mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; font-size: 14px;">
                                <span style="color: #67666e;">Tr·∫ª em (<12 tu·ªïi):</span>
                                <span style="float: right; font-weight: 600; color: #dc3545;">0mg/ng√†y</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Info Box (when no result) -->
                <div class="cart-info" th:unless="${result}">
                    <h2 class="cart-info__heading">Th√¥ng tin</h2>
                    <div style="padding: 16px 0;">
                        <p style="font-size: 14px; color: #67666e; line-height: 1.8; margin-bottom: 16px;">
                            CC-Doctor gi√∫p b·∫°n t√≠nh to√°n l∆∞·ª£ng caffeine ƒë√£ n·∫°p v√†o c∆° th·ªÉ v√† so s√°nh v·ªõi m·ª©c an to√†n ƒë∆∞·ª£c khuy·∫øn ngh·ªã.
                        </p>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">üìä Gi·ªõi h·∫°n an to√†n</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Ng∆∞·ªùi l·ªõn (18+):</span>
                                <span style="float: right; font-weight: 600;">400mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Ph·ª• n·ªØ mang thai:</span>
                                <span style="float: right; font-weight: 600;">200mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #ededf6; font-size: 14px;">
                                <span style="color: #67666e;">Thanh thi·∫øu ni√™n (12-18):</span>
                                <span style="float: right; font-weight: 600;">100mg/ng√†y</span>
                            </li>
                            <li style="padding: 8px 0; font-size: 14px;">
                                <span style="color: #67666e;">Tr·∫ª em (<12 tu·ªïi):</span>
                                <span style="float: right; font-weight: 600; color: #dc3545;">0mg/ng√†y</span>
                            </li>
                        </ul>
                        <p style="font-size: 12px; color: #9e9da8; margin-top: 16px; font-style: italic;">
                            * D·ªØ li·ªáu tham kh·∫£o t·ª´ FDA v√† c√°c t·ªï ch·ª©c y t·∫ø qu·ªëc t·∫ø
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer th:replace="~{fragments/footer :: footer}"></footer>

<!-- Scripts -->
<script th:src="@{/assets/js/scripts.js}"></script>
</body>
</html>
