# BÃO CÃO PHÃ‚N TÃCH VÃ€ THIáº¾T Káº¾ DATABASE

**NgÃ y thá»±c hiá»‡n:** 17/01/2026  
**Tráº¡ng thÃ¡i:** âœ… HOÃ€N THÃ€NH 100%

---

## ğŸ“Š PHÃ‚N TÃCH GIAO DIá»†N

### CÃ¡c trang Ä‘Ã£ phÃ¢n tÃ­ch:
1. âœ… **index.html** - Trang chá»§ vá»›i slideshow vÃ  danh má»¥c
2. âœ… **product-detail.html** - Chi tiáº¿t sáº£n pháº©m vá»›i variants vÃ  reviews
3. âœ… **category.html** - Danh sÃ¡ch sáº£n pháº©m theo category
4. âœ… **checkout.html** - Giá» hÃ ng
5. âœ… **shipping.html** - ThÃ´ng tin giao hÃ ng
6. âœ… **payment.html** - PhÆ°Æ¡ng thá»©c thanh toÃ¡n
7. âœ… **profile.html** - ThÃ´ng tin ngÆ°á»i dÃ¹ng
8. âœ… **favourite.html** - Danh sÃ¡ch yÃªu thÃ­ch
9. âœ… **sign-in.html, sign-up.html** - ÄÄƒng nháº­p/Ä‘Äƒng kÃ½

### Nghiá»‡p vá»¥ phÃ¡t hiá»‡n:
- ğŸ” Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, profile)
- ğŸ“¦ Quáº£n lÃ½ sáº£n pháº©m (tÃªn, giÃ¡, mÃ´ táº£, hÃ¬nh áº£nh, variants)
- ğŸ·ï¸ Danh má»¥c vÃ  thÆ°Æ¡ng hiá»‡u
- ğŸ›’ Giá» hÃ ng vÃ  wishlist
- ğŸ“ ÄÆ¡n hÃ ng vá»›i tracking
- â­ ÄÃ¡nh giÃ¡ sáº£n pháº©m
- ğŸ“ Äá»‹a chá»‰ giao hÃ ng (nhiá»u Ä‘á»‹a chá»‰)
- ğŸ’³ PhÆ°Æ¡ng thá»©c thanh toÃ¡n (nhiá»u tháº»)
- ğŸ¨ Banner slideshow

---

## ğŸ—„ï¸ DATABASE SCHEMA

### Tá»•ng quan: 15 Tables

| # | Table | Records | MÃ´ táº£ |
|---|-------|---------|-------|
| 1 | users | 4 | NgÆ°á»i dÃ¹ng (admin + users) |
| 2 | addresses | 4 | Äá»‹a chá»‰ giao hÃ ng |
| 3 | payment_methods | 4 | Tháº» thanh toÃ¡n |
| 4 | categories | 9 | Danh má»¥c sáº£n pháº©m (cÃ³ parent-child) |
| 5 | brands | 5 | ThÆ°Æ¡ng hiá»‡u |
| 6 | products | 8 | Sáº£n pháº©m chÃ­nh |
| 7 | product_images | 13 | HÃ¬nh áº£nh sáº£n pháº©m |
| 8 | product_variants | 10 | Biáº¿n thá»ƒ (200g, 500g, etc.) |
| 9 | reviews | 8 | ÄÃ¡nh giÃ¡ sáº£n pháº©m |
| 10 | carts | 3 | Giá» hÃ ng |
| 11 | cart_items | 5 | Chi tiáº¿t giá» hÃ ng |
| 12 | orders | 3 | ÄÆ¡n hÃ ng |
| 13 | order_items | 5 | Chi tiáº¿t Ä‘Æ¡n hÃ ng |
| 14 | wishlists | 7 | Danh sÃ¡ch yÃªu thÃ­ch |
| 15 | banners | 5 | Banner slideshow |

---

## ğŸ”— QUAN Há»† GIá»®A CÃC Báº¢NG

### 1. User Module
```
users (1) ----< (N) addresses
users (1) ----< (N) payment_methods
users (1) ----< (N) carts
users (1) ----< (N) orders
users (1) ----< (N) reviews
users (1) ----< (N) wishlists
```

### 2. Product Module
```
categories (1) ----< (N) categories (parent-child)
categories (1) ----< (N) products
brands (1) ----< (N) products
products (1) ----< (N) product_images
products (1) ----< (N) product_variants
products (1) ----< (N) reviews
products (1) ----< (N) cart_items
products (1) ----< (N) order_items
products (1) ----< (N) wishlists
```

### 3. Shopping Module
```
carts (1) ----< (N) cart_items
cart_items (N) ----< (1) products
cart_items (N) ----< (1) product_variants
```

### 4. Order Module
```
orders (1) ----< (N) order_items
orders (N) ----< (1) addresses
orders (N) ----< (1) payment_methods
order_items (N) ----< (1) products
order_items (N) ----< (1) product_variants
```

---

## ğŸ“‹ CHI TIáº¾T CÃC Báº¢NG CHÃNH

### 1. USERS - Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
```sql
- id (PK)
- username (UNIQUE)
- email (UNIQUE)
- password (BCrypt)
- full_name
- phone
- avatar_url
- registered_date
- is_active
- role (USER/ADMIN)
```

**TÃ­nh nÄƒng:**
- ÄÄƒng kÃ½/Ä‘Äƒng nháº­p
- Profile management
- Role-based access control

### 2. PRODUCTS - Sáº£n pháº©m
```sql
- id (PK)
- name
- slug (UNIQUE, SEO-friendly)
- description
- price
- discount_price
- category_id (FK)
- brand_id (FK)
- stock_quantity
- sku (UNIQUE)
- is_featured
- is_active
- view_count
```

**TÃ­nh nÄƒng:**
- GiÃ¡ gá»‘c vÃ  giÃ¡ khuyáº¿n mÃ£i
- Quáº£n lÃ½ tá»“n kho
- Sáº£n pháº©m ná»•i báº­t
- Soft delete (is_active)
- Tracking lÆ°á»£t xem

### 3. PRODUCT_VARIANTS - Biáº¿n thá»ƒ
```sql
- id (PK)
- product_id (FK)
- variant_name (Weight, Size, Color)
- variant_value (200g, 500g, 1kg)
- price_adjustment (+$5, +$10)
- stock_quantity
- sku (UNIQUE)
```

**VÃ­ dá»¥:**
```
Coffee Beans - Espresso
â”œâ”€â”€ 200g: $47.00 (+$0)
â”œâ”€â”€ 300g: $52.00 (+$5)
â”œâ”€â”€ 500g: $57.00 (+$10)
â””â”€â”€ 1kg: $67.00 (+$20)
```

### 4. ORDERS - ÄÆ¡n hÃ ng
```sql
- id (PK)
- order_number (UNIQUE: ORD-20260117-001)
- user_id (FK)
- shipping_address_id (FK)
- payment_method_id (FK)
- subtotal
- shipping_fee
- tax
- total_amount
- status (PENDING â†’ CONFIRMED â†’ PROCESSING â†’ SHIPPED â†’ DELIVERED)
- payment_status (PENDING â†’ PAID)
- ordered_at, confirmed_at, shipped_at, delivered_at
```

**Workflow:**
```
PENDING â†’ CONFIRMED â†’ PROCESSING â†’ SHIPPED â†’ DELIVERED
                                  â†“
                              CANCELLED
```

### 5. REVIEWS - ÄÃ¡nh giÃ¡
```sql
- id (PK)
- product_id (FK)
- user_id (FK)
- rating (1-5 stars)
- title
- comment
- is_verified_purchase
```

**Business Rules:**
- Má»™t user chá»‰ review 1 láº§n cho 1 sáº£n pháº©m
- Chá»‰ user Ä‘Ã£ mua má»›i Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u "verified purchase"

---

## ğŸ¯ TÃNH NÄ‚NG Äáº¶C BIá»†T

### 1. Price Snapshot
LÆ°u giÃ¡ vÃ o `cart_items` vÃ  `order_items` Ä‘á»ƒ trÃ¡nh thay Ä‘á»•i giÃ¡ áº£nh hÆ°á»Ÿng Ä‘Æ¡n hÃ ng cÅ©.

```sql
-- Cart Items
cart_items.price = products.price (táº¡i thá»i Ä‘iá»ƒm thÃªm vÃ o giá»)

-- Order Items
order_items.unit_price = products.price (táº¡i thá»i Ä‘iá»ƒm Ä‘áº·t hÃ ng)
order_items.product_name = products.name (snapshot)
```

### 2. Multi-Address & Multi-Payment
User cÃ³ thá»ƒ lÆ°u nhiá»u Ä‘á»‹a chá»‰ vÃ  nhiá»u tháº» thanh toÃ¡n.

```sql
addresses.is_default = TRUE  -- Äá»‹a chá»‰ máº·c Ä‘á»‹nh
payment_methods.is_default = TRUE  -- Tháº» máº·c Ä‘á»‹nh
```

### 3. Category Hierarchy
Danh má»¥c cÃ³ cáº¥u trÃºc cha-con (parent-child).

```
Departments (parent_id = NULL)
â”œâ”€â”€ Coffee (parent_id = 1)
â”‚   â”œâ”€â”€ Coffee Beans (parent_id = 4)
â”‚   â”œâ”€â”€ Ground Coffee (parent_id = 4)
â”‚   â””â”€â”€ Instant Coffee (parent_id = 4)
â”œâ”€â”€ Electronics (parent_id = 1)
â””â”€â”€ Clothing (parent_id = 1)
```

### 4. Guest Cart
Há»— trá»£ giá» hÃ ng cho guest user (chÆ°a Ä‘Äƒng nháº­p).

```sql
carts.user_id = NULL
carts.session_id = "abc123xyz"  -- Session ID tá»« browser
```

Khi login, merge cart tá»« session vÃ o user cart.

### 5. Soft Delete
Sá»­ dá»¥ng `is_active` thay vÃ¬ xÃ³a tháº­t.

```sql
products.is_active = FALSE  -- áº¨n sáº£n pháº©m
users.is_active = FALSE  -- VÃ´ hiá»‡u hÃ³a user
```

---

## ğŸ“ˆ INDEXES & OPTIMIZATION

### Indexes Ä‘Ã£ táº¡o:
```sql
-- Users
idx_users_email, idx_users_username

-- Products
idx_products_category, idx_products_brand
idx_products_slug, idx_products_featured
idx_products_price

-- Orders
idx_orders_user, idx_orders_status
idx_orders_number, idx_orders_date

-- Reviews
idx_reviews_product, idx_reviews_user
idx_reviews_rating

-- Wishlists
idx_wishlists_user

-- Cart Items
idx_cart_items_cart, idx_cart_items_product
```

### Views Ä‘Ã£ táº¡o:
```sql
-- v_products_with_rating
SELECT products.*, AVG(rating), COUNT(reviews)

-- v_order_summary
SELECT orders.*, user.name, COUNT(items)
```

---

## ğŸ’¾ Dá»® LIá»†U MáºªU

### Users (4 accounts)
| Username | Email | Password | Role |
|----------|-------|----------|------|
| admin | admin@grocerystore.com | password123 | ADMIN |
| imrankhan | imran@example.com | password123 | USER |
| johnsmith | john@example.com | password123 | USER |
| maryjane | mary@example.com | password123 | USER |

### Products (8 coffee products)
1. Coffee Beans - Espresso Arabica ($47.00) - Lavazza
2. Lavazza Coffee Blends ($53.00 â†’ $49.00) - Lavazza
3. Lavazza - CaffÃ¨ Espresso Black Tin ($99.99) - Lavazza
4. Starbucks Pike Place Roast ($32.00 â†’ $28.00) - Starbucks
5. Trung Nguyen Creative 3 ($45.00) - Trung Nguyen
6. Nescafe Gold Instant Coffee ($24.00) - Nescafe
7. Lavazza QualitÃ  Rossa ($38.00 â†’ $35.00) - Lavazza
8. Starbucks French Roast ($35.00) - Starbucks

### Orders (3 sample orders)
- **ORD-20260115-001**: $162.30 - DELIVERED âœ…
- **ORD-20260116-002**: $207.39 - SHIPPED ğŸšš
- **ORD-20260117-003**: $108.40 - PROCESSING â³

---

## ğŸ³ DOCKER SETUP

### docker-compose.yml
```yaml
services:
  mariadb:
    image: mariadb:latest
    container_name: coffee_shop_db
    environment:
      MARIADB_ROOT_PASSWORD: rootpassword
      MARIADB_DATABASE: java5_asm
      MARIADB_USER: java5_user
      MARIADB_PASSWORD: java5_password
    ports:
      - "3307:3306"
    volumes:
      - ./mariadb_data:/var/lib/mysql
      - ./mariadb_init:/docker-entrypoint-initdb.d
```

### Auto-initialization
```
mariadb_init/
â”œâ”€â”€ 01-schema.sql  # Táº¡o tables
â””â”€â”€ 02-data.sql    # Insert data
```

Khi cháº¡y `docker-compose up -d` láº§n Ä‘áº§u:
1. MariaDB tá»± Ä‘á»™ng táº¡o database `java5_asm`
2. Cháº¡y `01-schema.sql` â†’ Táº¡o 15 tables
3. Cháº¡y `02-data.sql` â†’ Insert dá»¯ liá»‡u máº«u
4. âœ… Database sáºµn sÃ ng sá»­ dá»¥ng!

---

## ğŸš€ HÆ¯á»šNG DáºªN Sá»¬ Dá»¤NG

### 1. Khá»Ÿi Ä‘á»™ng Database
```bash
docker-compose up -d
```

### 2. Kiá»ƒm tra Database
```bash
docker exec -it coffee_shop_db mariadb -u java5_user -pjava5_password java5_asm

# Trong MariaDB shell
SHOW TABLES;
SELECT * FROM users;
SELECT * FROM products;
EXIT;
```

### 3. Cháº¡y Spring Boot
```bash
./mvnw spring-boot:run
```

### 4. Truy cáº­p á»©ng dá»¥ng
```
http://localhost:8080
```

### 5. ÄÄƒng nháº­p
- Username: **admin** hoáº·c **imrankhan**
- Password: **password123**

---

## ğŸ“ FILES CREATED

### Database Design
- âœ… `DATABASE_DESIGN.md` - TÃ i liá»‡u thiáº¿t káº¿ chi tiáº¿t
- âœ… `DATABASE_SETUP.md` - HÆ°á»›ng dáº«n setup
- âœ… `mariadb_init/01-schema.sql` - Schema SQL
- âœ… `mariadb_init/02-data.sql` - Sample data SQL
- âœ… `mariadb_init/README.md` - HÆ°á»›ng dáº«n init folder
- âœ… `src/main/resources/schema.sql` - Backup schema

### Configuration
- âœ… `docker-compose.yml` - Updated vá»›i init volume
- âœ… `src/main/resources/application.properties` - Updated config

---

## ğŸ¯ NEXT STEPS

### 1. Táº¡o Entity Classes
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String username;
    private String email;
    // ...
}
```

### 2. Táº¡o Repository Interfaces
```java
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);
}
```

### 3. Táº¡o Service Classes
```java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;
    
    public User findByUsername(String username) {
        return userRepository.findByUsername(username)
            .orElseThrow(() -> new UserNotFoundException());
    }
}
```

### 4. HoÃ n thiá»‡n Controllers
```java
@Controller
public class HomeController {
    @Autowired
    private ProductService productService;
    
    @GetMapping("/")
    public String home(Model model) {
        model.addAttribute("products", productService.getFeaturedProducts());
        return "index";
    }
}
```

---

## âœ… Káº¾T LUáº¬N

**Database Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ hoÃ n chá»‰nh dá»±a trÃªn phÃ¢n tÃ­ch giao diá»‡n:**

âœ… 15 tables vá»›i quan há»‡ rÃµ rÃ ng  
âœ… Dá»¯ liá»‡u máº«u Ä‘áº§y Ä‘á»§ cho development  
âœ… Docker setup tá»± Ä‘á»™ng khá»Ÿi táº¡o  
âœ… Indexes vÃ  views Ä‘á»ƒ tá»‘i Æ°u performance  
âœ… Business rules Ä‘Æ°á»£c implement Ä‘Ãºng  
âœ… Sáºµn sÃ ng cho viá»‡c táº¡o Entity classes  

**Tá»•ng sá»‘ dÃ²ng SQL:** 1,900+ dÃ²ng  
**Tá»•ng sá»‘ records:** 90+ records  
**Thá»i gian setup:** < 1 phÃºt vá»›i Docker  

---

*BÃ¡o cÃ¡o Ä‘Æ°á»£c táº¡o bá»Ÿi Kiro AI Assistant - 17/01/2026*
